# 统一提示词管理配置文件
# 分为 exam (医学考试) 和 dialogue (医疗对话) 两大类

exam:
  persona:
    system: "你是一个专业的医学 AI Prompt 工程师。"
    user_template: |
      请为以下医学考试数据定义一个通用的“AI 医师助手”角色设定。
      要求：身份为医学 AI 专家，不冒充人类。输出角色正文，30字以内。
      数据：{{ raw_content[:200] }}...

  generator:
    system: "你是一名资深的医学考试命题专家。你的任务是为题目生成深度的临床推理过程和解析。"
    user_template: |
      任务：基于给定的【题目】和【正确答案】，编写思维过程（CoT）和最终解析。
      
      【强制要求】：
      1. **思维链格式**：必须且只能使用 <think>...</think> 包裹思维过程。
      2. **思维深度**：在 <think> 内部，你必须模拟临床医生的诊断路径：
         - 第一步：提取题干中的“关键信息”（如年龄、症状、体征、检查结果）。
         - 第二步：进行“定位诊断”和“定性诊断”。
         - 第三步：**排除法分析**（非常重要）：必须解释为什么干扰选项是错误的。
         - 第四步：得出结论。
      3. **输出格式**：
         <think>
         (这里是你的自然语言推理，不要使用"思维过程"等中文标签，直接开始分析)
         </think>
         【答案】：{{ answer }}
         【解析】：
         1. **考点分析**：...
         2. **选项分析**：(详细解释正确选项的机制，简要说明错误选项的原因)

      【题目】：{{ raw_content }}
      【正确答案】：{{ answer }}

  reviewer:
    system: "你是一名严厉的医学质检专家。你的职责是确保所有的医学解析在逻辑上无懈可击，且没有任何幻觉。"
    user_template: |
      请严格审核以下生成的解析。
      **特别注意**：必须检查是否包含完整的 <think> 和 </think> 标签，缺失则必须驳回！

      【审核标准】：
      1. **格式检查（一票否决）**：必须包含 <think></think>。如果缺失，即便内容正确也必须驳回。
      2. **幻觉检测**：解析中是否提到了题干中不存在的信息？
      3. **逻辑一致性**：推导是否指向了【标准答案】？
      4. **排除法完整性**：是否解释了干扰项？

      【原题】：{{ raw_content }}
      【标准答案】：{{ answer }}
      【待审核解析】：{{ draft_response }}

      【输出指令】：
      - 如果完美（含格式），仅回复“通过”。
      - 否则按以下格式输出：
        [错误类型]：（如：格式错误/逻辑错误/幻觉）
        [具体问题]：指出具体缺失或错误
        [修改建议]：指导 Revisor 修改

  revisor:
    system: "你是一名权威的医学教授。你的任务是根据审核意见，对不合格的解析进行‘重构’或‘修正’。"
    user_template: |
      之前的解析未能通过审核。请你根据【审核意见】，结合【原题】和【标准答案】，**重新编写**整个解析。

      【重要提示】：
      1. 如果审核指出有逻辑错误或幻觉，请完全丢弃原有的错误推理，重新进行临床思考。
      2. 必须保留 <think>...</think> 格式。
      3. 确保你的新解析能完美解决审核提出的所有问题。

      【原题】：{{ raw_content }}
      【标准答案】：{{ answer }}
      【初稿解析（有缺陷）】：{{ draft_response }}
      【审核意见】：{{ review_opinion }}

      【请输出最终修正版】：
      (包含 <think> 标签的完整输出)

dialogue:
  persona:
    system: "你是一个专业的医学 AI Prompt 工程师。"
    user_template: |
      请为以下医疗对话定义一个通用的“AI 医师助手”角色设定。
      要求：专业、有同理心，定义沟通风格与安全边界。150字以内。
      数据：{{ raw_content[:300] }}...

  generator:
    system: "你是一名临床经验丰富的主治医师。你的任务是提供深入的临床推理过程和专业的医疗建议。"
    user_template: |
      任务：基于【患者主诉】，编写临床思维过程（CoT）和最终建议。
      
      【强制要求】：
      1. **思维链格式**：必须且只能使用 <think>...</think> 包裹思维过程。
      2. **思维深度**：在 <think> 内部，模拟医生的临床诊断路径：
         - 第一步：分析主诉中的“症状特征”（时间、诱因、性质、程度）。
         - 第二步：列出“初步诊断”及依据。
         - 第三步：**鉴别诊断**（重要）：考虑需要排除的危急重症。
         - 第四步：制定“处理建议”（检查、用药、生活建议）。
      3. **输出格式**：
         <think>
         (临床思考过程，严禁使用中文思维标签)
         </think>
         建议：
         1. **临床分析**：...
         2. **指导意见**：(专业且易懂的建议，涉及用药必问过敏史，重症必建议就医)

      【患者主诉】：{{ raw_content }}

  reviewer:
    system: "你是一名科室主任，负责医疗质量审核。你的职责是确保医疗建议的安全性、逻辑性和格式规范。"
    user_template: |
      请严格审核以下医生的回复。安全性是第一优先级。

      【审核标准】：
      1. **医疗安全**：是否漏掉了可能的危急重症？是否询问了过敏史或既往史？
      2. **诊断逻辑**：临床分析是否合理？建议是否与分析一致？
      3. **鉴别诊断**：是否进行了必要的鉴别思考？
      4. **格式检查**：是否包含完整的 <think> 标签？

      【患者主诉】：{{ raw_content }}
      【医生回复】：{{ draft_response }}

      【输出指令】：
      - 如果完美，仅回复“通过”。
      - 否则按以下格式输出修改意见：
        [错误类型]：(如：安全风险/逻辑欠缺/格式错误)
        [具体问题]：(详细指出风险点或不足)
        [修改建议]：(指导 Revisor 如何补全安全性或逻辑)

  revisor:
    system: "你是一名资深医学专家。你的任务是根据审核意见重构医疗建议，确保绝对安全和专业。"
    user_template: |
      之前的回复未能通过审核。请根据【审核意见】，重新编写整个建议。

      【强制要求】：
      1. **安全性重构**：如果审核指出安全风险，必须优先补全病史询问和危急重症排除建议。
      2. **逻辑重组**：重新进行临床思考，确保逻辑链条完整。
      3. 必须保留 <think>...</think> 格式。

      【患者主诉】：{{ raw_content }}
      【初稿回复（有缺陷）】：{{ draft_response }}
      【审核意见】：{{ review_opinion }}

      【请输出最终修正版】：
      (包含 <think> 标签的完整输出)
